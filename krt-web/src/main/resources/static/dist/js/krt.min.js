$.ajaxSetup({complete:function(a,b){if(a.getResponseHeader("Session-Status")=="timeout"){krt.layer.msg("登陆超时!请重新登陆!",function(){top.location.href=krt.util.getBasePath()+"/login"})}else{if(b=="parsererror"){krt.layer.msg("JSON解析错误！")}}},});var layer=top.layer;var layer_loading;var layer_window;var layer_confirm;window.krt={ajax:function(c){if(krt.util.isUndefind(c.beforeSend)){c.beforeSend=function(){if(!krt.util.isUndefind(c.validateForm)){return c.validateForm.form()&&krt.layer.loading()}else{return krt.layer.loading()}}}var a=c.success;c.success=function(d,e,f){krt.layer.closeloading();a(d,e,f)};if(!krt.util.isUndefind(c.error)){var b=c.error;c.error=function(d,e,f){krt.layer.closeloading();b(d,e,f)}}$.ajax(c)},tab:{openTab:function(d,a){var c=getActiveTab();var b=c.attr("id");openTab(a,d,false,b)},getContentWindow:function(){var b=getActiveTab();var a=b[0].contentWindow;return a},closeThisTabs:function(c){var b=getActiveTab();var a=b.data("preid");$(".page-tabs-content").children(".active").find(".fa-close").trigger("click");a&&c&&c($("#iframe"+a)[0].contentWindow);a&&$("#tab"+a).trigger("click")},refreshIframe:function(){var b=getActiveTab();var d=b.data("id");var c=$('.J_iframe[data-id="'+d+'"]');var a=c.attr("src");krt.layer.loading();c.attr("src",a).load(function(){krt.layer.closeloading()})},},layer:{msg:function(a){layer.msg(a,function(){})},msg:function(a,b){layer.msg(a,{time:1000},b)},loading:function(){layer_loading=layer.load()},closeloading:function(){layer.close(layer_loading)},confirm:function(a,b){layer_confirm=layer.confirm(a,{btn:["确定","取消"]},b,function(){layer.close(layer_confirm)})},alert:function(a){layer.alert(a)},open:function(a){layer.open(a)},close:function(a){layer.close(a)},getFrameIndex:function(){return layer.getFrameIndex(window.name)},openDialog:function(e,b,c,a,d){layer_window=layer.open({type:2,area:[c,a],title:e,maxmin:true,content:b,btn:["确定","关闭"],yes:function(g,f){var h=f.find("iframe")[0];h.contentWindow.doSubmit()},cancel:function(f){layer.close(f)}});if(navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)){layer.full(layer_window)}else{if(d){layer.full(layer_window)}}},openDialogView:function(e,b,c,a,d){layer_window=layer.open({type:2,area:[c,a],title:e,maxmin:true,content:b,btn:["关闭"],cancel:function(f){layer.close(f)}});if(navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)){layer.full(layer_window)}else{if(d){layer.full(layer_window)}}}},util:{getBasePath:function(){var b=window.location;var a=b.pathname.split("/")[1];var c=b.protocol+"//"+b.host+"/"+a;return c},isNull:function(a){if(a==null||a=="null"){return""}else{return a}},isUndefind:function(a){if(typeof(a)=="undefined"){return true}else{return false}},underline2Camel:function(b){var a=/-(\w)/g;return b.replace(a,function(d,c){return c.toUpperCase()})},camel2Underline:function(a){a=a.replace(/([A-Z])/g,"_$1").toLowerCase();return a},set:function(a,c){var b=new Date().getTime();localStorage.setItem(a,JSON.stringify({data:c,time:b}))},get:function(c,e){var d=localStorage.getItem(c);if(d!=null){var a=JSON.parse(d);if(e!=-1){if(new Date().getTime()-a.time>e){localStorage.removeItem(c);return null}else{var b=a.data;return b}}else{var b=a.data;return b}}else{return null}},getDic:function(b,c){if(b==""||c==""){return""}var a="Dic:"+b+":"+c;var d=krt.util.get(a,1000*60);if(d!=""&&d!=null){return d.data}else{var e="";$.ajax({url:krt.util.getBasePath()+"/common/getDic",type:"GET",async:false,data:{"type":b,"code":c},success:function(f){if(f.code===200){krt.util.set(a,f);e=f.data}else{krt.layer.msg(f.msg)}},error:function(){krt.layer.msg("查询字典错误!")}});return e}}},table:{reloadTable:function reloadTable(d){var b;if(window.datatable==null||window.datatable=="undefined"){var g=top.$(".J_iframe:visible");if(g[0]==null||g[0]=="undefined"){b=parent.window.datatable;b.ajax.reload(false)}else{b=g[0].contentWindow.datatable;b.ajax.reload(false)}}else{b=window.datatable;var h=b.context[0]._iDisplayStart;var f=b.context[0]._iDisplayLength;var e=b.context[0]._iRecordsDisplay;var a=false;if(d==null||krt.util.isUndefind(d)){if((e-h)===1){if(h>0){a=true}}}else{var c=d.split(",");if(((e-(h+c.length))<=0)||c.length===f){if(h>0){a=true}}}if(a){b.page("previous").draw(false)}else{b.ajax.reload(null,false)}}}}};